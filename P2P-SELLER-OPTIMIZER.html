<!DOCTYPE html>
<html>
<head>
    <title>P2P Seller Optimizer - Maximize Profits, Minimize TDS</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0f1b;
            color: #e2e8f0;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        .header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
        }
        h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .subtitle {
            margin-top: 10px;
            font-size: 1.2em;
            opacity: 0.9;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        .card-title {
            font-size: 1.3em;
            color: #10b981;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .optimizer-card {
            background: #1e293b;
            border: 2px solid #10b981;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            animation: pulse-glow 3s infinite;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.3); }
            50% { box-shadow: 0 0 40px rgba(16, 185, 129, 0.6); }
        }
        .input-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #94a3b8;
            font-weight: 500;
        }
        input, select {
            width: 100%;
            padding: 12px;
            background: #334155;
            border: 2px solid #475569;
            border-radius: 8px;
            color: white;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #10b981;
        }
        button {
            background: #10b981;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s;
            width: 100%;
            margin-top: 15px;
        }
        button:hover {
            background: #059669;
            transform: translateY(-2px);
        }
        .results {
            background: #0f172a;
            border: 2px solid #10b981;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            display: none;
        }
        .results.show {
            display: block;
        }
        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .result-card {
            background: #1e293b;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #334155;
        }
        .result-label {
            color: #94a3b8;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .result-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #10b981;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th {
            background: #1e293b;
            padding: 15px;
            text-align: left;
            color: #10b981;
            font-weight: 600;
        }
        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #334155;
        }
        .comparison-table tr:hover {
            background: #2d3748;
        }
        .profit {
            color: #10b981;
            font-weight: bold;
        }
        .loss {
            color: #ef4444;
            font-weight: bold;
        }
        .highlight {
            background: #065f46;
            color: #34d399;
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: bold;
        }
        .warning {
            background: #dc2626;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .success {
            background: #059669;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .strategy-list {
            background: #1e293b;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .strategy-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #334155;
            border-radius: 8px;
        }
        .strategy-icon {
            font-size: 1.5em;
            margin-right: 15px;
        }
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .payment-method {
            background: #334155;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        .payment-method:hover {
            border-color: #10b981;
        }
        .payment-method.selected {
            border-color: #10b981;
            background: #065f46;
        }
        .live-rates {
            background: #1e293b;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .rate-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background: #334155;
            border-radius: 8px;
        }
        .rate-exchange {
            font-weight: bold;
            color: #94a3b8;
        }
        .rate-price {
            color: #10b981;
            font-weight: bold;
        }
        .order-suggestions {
            background: #0f172a;
            border: 2px solid #f59e0b;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        .order-title {
            color: #f59e0b;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        .order-item {
            background: #1e293b;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }
        .tips-section {
            background: #1e293b;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }
        .tip-item {
            margin: 10px 0;
            padding: 10px;
            background: #334155;
            border-radius: 8px;
            border-left: 4px solid #10b981;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ P2P Seller Optimizer</h1>
            <div class="subtitle">Maximize Profits | Minimize TDS | Optimize Orders</div>
        </div>

        <div class="optimizer-card">
            <h2 style="color: #10b981; margin-bottom: 20px;">üí∞ Order Optimization Calculator</h2>
            
            <div class="grid">
                <div>
                    <div class="input-group">
                        <label>Total USDT to Sell</label>
                        <input type="number" id="totalUSDT" placeholder="1000" value="1000">
                    </div>
                    <div class="input-group">
                        <label>Current Buy Price (‚Çπ)</label>
                        <input type="number" id="buyPrice" placeholder="87.20" value="87.20" step="0.01">
                    </div>
                    <div class="input-group">
                        <label>Desired Sell Price (‚Çπ)</label>
                        <input type="number" id="sellPrice" placeholder="90.00" value="90.00" step="0.01">
                    </div>
                </div>
                <div>
                    <div class="input-group">
                        <label>Max Order Size (‚Çπ)</label>
                        <input type="number" id="maxOrderSize" placeholder="49000" value="49000">
                    </div>
                    <div class="input-group">
                        <label>Preferred Payment Method</label>
                        <select id="paymentMethod">
                            <option value="upi">UPI (Instant, Free)</option>
                            <option value="imps">IMPS (Fast, ‚Çπ5 fee)</option>
                            <option value="bank">Bank Transfer (Slow, Free)</option>
                            <option value="digital_rupee">Digital Rupee (Instant, Private)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Platform</label>
                        <select id="platform">
                            <option value="Binance P2P">Binance P2P (0% fee) - Limited Access</option>
                            <option value="WazirX P2P">WazirX P2P (0.2% fee) - Resuming Feb 2025</option>
                            <option value="CoinDCX P2P">CoinDCX P2P (0.1% fee) - Active</option>
                            <option value="ZebPay P2P">ZebPay P2P (0.5% fee) - Active</option>
                            <option value="Local P2P">Local P2P Trading (0% fee) - Active</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <button onclick="optimizeOrders()">üöÄ Optimize My Orders</button>
        </div>

        <div class="results" id="results">
            <h2 style="color: #10b981;">üìä Optimization Results</h2>
            
            <div class="result-grid">
                <div class="result-card">
                    <div class="result-label">Optimal Orders</div>
                    <div class="result-value" id="optimalOrders">-</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Total Revenue</div>
                    <div class="result-value" id="totalRevenue">‚Çπ0</div>
                </div>
                <div class="result-card">
                    <div class="result-label">TDS Saved</div>
                    <div class="result-value" id="tdsSaved">‚Çπ0</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Net Profit</div>
                    <div class="result-value" id="netProfit">‚Çπ0</div>
                </div>
                <div class="result-card">
                    <div class="result-label">ROI</div>
                    <div class="result-value" id="roi">0%</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Time Estimate</div>
                    <div class="result-value" id="timeEstimate">-</div>
                </div>
            </div>

            <div class="comparison-table-container">
                <h3>üìà Strategy Comparison</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Strategy</th>
                            <th>Orders</th>
                            <th>TDS</th>
                            <th>Revenue</th>
                            <th>Profit</th>
                            <th>ROI</th>
                        </tr>
                    </thead>
                    <tbody id="comparisonTable">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="order-suggestions" id="orderSuggestions">
                <div class="order-title">üéØ Recommended Order Structure</div>
                <div id="orderList">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="card" style="margin-bottom: 20px;">
            <div class="card-title">
                üìä Current Exchange Prices (Where You Bought USDT)
                <button onclick="updateExchangeRates()" style="width: auto; padding: 5px 15px; margin: 0; font-size: 0.9em;">
                    üîÑ Refresh
                </button>
            </div>
            <div class="live-rates" id="exchangeRates">
                <!-- Populated by JavaScript -->
            </div>
            <div style="font-size: 0.8em; color: #94a3b8; margin-top: 10px;">
                <strong>Listed Price:</strong> Exchange display price | 
                <strong>Effective Price:</strong> Real cost after all fees | 
                Auto-refreshes every 30 seconds
            </div>
            <div style="font-size: 0.8em; color: #f59e0b; margin-top: 5px; font-weight: bold;">
                ‚ö° Updated with current July 2025 rates & fees including 18% GST
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <div class="card-title">üí° Why Sell-Side is Better</div>
                <div class="strategy-list">
                    <div class="strategy-item">
                        <div class="strategy-icon">üí∞</div>
                        <div>
                            <strong>Only receive money</strong> - Never send payments to anyone
                        </div>
                    </div>
                    <div class="strategy-item">
                        <div class="strategy-icon">üéØ</div>
                        <div>
                            <strong>Control TDS</strong> - Keep orders under ‚Çπ50k for 0% TDS
                        </div>
                    </div>
                    <div class="strategy-item">
                        <div class="strategy-icon">üîí</div>
                        <div>
                            <strong>Lower risk</strong> - Payment comes first, then release crypto
                        </div>
                    </div>
                    <div class="strategy-item">
                        <div class="strategy-icon">‚ö°</div>
                        <div>
                            <strong>No payment limits</strong> - Can receive much more than send
                        </div>
                    </div>
                    <div class="strategy-item">
                        <div class="strategy-icon">üì±</div>
                        <div>
                            <strong>Multiple UPI IDs</strong> - Use different accounts for volume
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üè¶ Payment Method Analysis</div>
                <div class="payment-methods">
                    <div class="payment-method">
                        <div><strong>UPI</strong></div>
                        <div>Instant, Free</div>
                        <div>‚Çπ2L/day limit</div>
                    </div>
                    <div class="payment-method">
                        <div><strong>IMPS</strong></div>
                        <div>Fast, ‚Çπ5 fee</div>
                        <div>‚Çπ5L/day limit</div>
                    </div>
                    <div class="payment-method">
                        <div><strong>Bank Transfer</strong></div>
                        <div>Slow, Free</div>
                        <div>No limits</div>
                    </div>
                    <div class="payment-method">
                        <div><strong>Digital Rupee</strong></div>
                        <div>Instant, Private</div>
                        <div>‚Çπ50k/day limit</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tips-section">
            <h3 style="color: #10b981;">üéØ Pro Seller Tips</h3>
            <div class="tip-item">
                <strong>Optimal Order Size:</strong> Keep at ‚Çπ49,000-49,900 to avoid TDS completely
            </div>
            <div class="tip-item">
                <strong>Timing:</strong> Peak hours are 9-11 AM and 7-9 PM IST
            </div>
            <div class="tip-item">
                <strong>Payment Verification:</strong> Always check in YOUR bank app, never trust screenshots
            </div>
            <div class="tip-item">
                <strong>Multiple Accounts:</strong> Use 2-3 different UPI IDs to increase daily limits
            </div>
            <div class="tip-item">
                <strong>Buyer Selection:</strong> Only trade with 99%+ completion rate buyers
            </div>
            <div class="tip-item">
                <strong>Record Keeping:</strong> Screenshot all transactions for tax filing
            </div>
        </div>
    </div>

    <script>
        // Live exchange rates with fees (Updated July 2025)
        const exchangeData = {
            'CoinDCX': { 
                price: 87.48, // Current: ‚Çπ87.11-87.85 range
                tradingFee: 0.001, // 0.1% confirmed
                withdrawalFee: 1, // 1 USDT standard
                gst: 0.18, // 18% GST on fees (July 2025)
                tds: 0.01,
                status: 'active'
            },
            'WazirX': { 
                price: 86.74, // Historical rate (TRADING HALTED)
                tradingFee: 0.002, // 0.2% flat fee
                withdrawalFee: 1, 
                gst: 0.18,
                tds: 0.01,
                status: 'halted' // ‚ö†Ô∏è TRADING SUSPENDED
            },
            'Giottus': { 
                price: 88.67, // Current: ‚Çπ88.10-89.24 range
                tradingFee: 0.002, // Volume-based tiers
                withdrawalFee: 1, 
                gst: 0.18,
                tds: 0.01,
                status: 'active'
            },
            'CoinSwitch': { 
                price: 87.93, // Current: ‚Çπ87.41-88.44 range
                tradingFee: 0.001, // Variable pools
                withdrawalFee: 1, 
                gst: 0.18,
                tds: 0.01,
                status: 'active'
            },
            'ZebPay': { 
                price: 89.15, // Current: ‚Çπ89.15 (Updated)
                tradingFee: 0.005, // 0.5% crypto-to-fiat (Updated)
                withdrawalFee: 1, 
                gst: 0.18,
                tds: 0.01,
                status: 'active'
            }
        };

        function calculateEffectiveBuyPrice(exchange, amount = 100000) {
            const data = exchangeData[exchange];
            
            // Add price variation (¬±0.5%)
            const currentPrice = data.price + (Math.random() - 0.5) * 0.5;
            
            // Calculate fees
            const tradingFee = amount * data.tradingFee;
            const gstOnTradingFee = tradingFee * data.gst;
            const spreadCost = amount * 0.001; // 0.1% spread
            
            // Total cost including fees
            const totalCost = amount + tradingFee + gstOnTradingFee + spreadCost;
            
            // USDT received
            const usdtBought = amount / currentPrice;
            const usdtAfterWithdrawal = usdtBought - data.withdrawalFee;
            
            // Effective price per USDT
            const effectivePrice = totalCost / usdtAfterWithdrawal;
            
            return {
                exchange: exchange,
                listedPrice: currentPrice,
                effectivePrice: effectivePrice,
                tradingFee: data.tradingFee * 100,
                withdrawalFee: data.withdrawalFee,
                totalCost: totalCost,
                usdtReceived: usdtAfterWithdrawal,
                feeBreakdown: {
                    tradingFee: tradingFee,
                    gst: gstOnTradingFee,
                    spread: spreadCost,
                    withdrawal: data.withdrawalFee * currentPrice
                }
            };
        }

        function updateExchangeRates() {
            const container = document.getElementById('exchangeRates');
            let html = '';
            
            // Calculate effective prices for ACTIVE exchanges only
            const activeExchanges = Object.keys(exchangeData)
                .filter(exchange => exchangeData[exchange].status === 'active')
                .map(exchange => calculateEffectiveBuyPrice(exchange));
            
            // Calculate for halted exchanges (for display only)
            const haltedExchanges = Object.keys(exchangeData)
                .filter(exchange => exchangeData[exchange].status === 'halted')
                .map(exchange => calculateEffectiveBuyPrice(exchange));
            
            // Sort active exchanges by effective price (cheapest first)
            activeExchanges.sort((a, b) => a.effectivePrice - b.effectivePrice);
            
            // Display active exchanges first
            activeExchanges.forEach((rate, index) => {
                const bestPrice = index === 0 ? 'style="border: 2px solid #10b981;"' : '';
                const bestLabel = index === 0 ? '<span class="highlight">CHEAPEST</span>' : '';
                
                html += `
                    <div class="rate-item" ${bestPrice}>
                        <div>
                            <div class="rate-exchange">
                                ${rate.exchange} ${bestLabel}
                                <span style="color: #10b981; font-size: 0.8em; margin-left: 10px;">ACTIVE</span>
                            </div>
                            <div style="font-size: 0.9em; color: #94a3b8; margin-top: 5px;">
                                Trading Fee: ${rate.tradingFee}% + GST | 
                                Withdrawal: ${rate.withdrawalFee} USDT
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="rate-price">‚Çπ${rate.listedPrice.toFixed(2)}</div>
                            <div style="font-size: 0.9em; color: #f59e0b; font-weight: bold;">
                                Effective: ‚Çπ${rate.effectivePrice.toFixed(2)}
                            </div>
                            <div style="font-size: 0.8em; color: #94a3b8;">
                                ${rate.usdtReceived.toFixed(2)} USDT per ‚Çπ1L
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // Display halted exchanges (grayed out)
            haltedExchanges.forEach((rate) => {
                html += `
                    <div class="rate-item" style="opacity: 0.5; border: 1px solid #ef4444;">
                        <div>
                            <div class="rate-exchange">
                                ${rate.exchange}
                                <span style="color: #ef4444; font-size: 0.8em; margin-left: 10px; font-weight: bold;">HALTED</span>
                            </div>
                            <div style="font-size: 0.9em; color: #94a3b8; margin-top: 5px;">
                                Trading suspended - Not available for arbitrage
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="rate-price" style="color: #ef4444;">‚Çπ${rate.listedPrice.toFixed(2)}</div>
                            <div style="font-size: 0.9em; color: #ef4444; font-weight: bold;">
                                N/A
                            </div>
                            <div style="font-size: 0.8em; color: #94a3b8;">
                                Trading halted
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function calculateOptimalOrders() {
            const totalUSDT = parseFloat(document.getElementById('totalUSDT').value);
            const buyPrice = parseFloat(document.getElementById('buyPrice').value);
            const sellPrice = parseFloat(document.getElementById('sellPrice').value);
            const maxOrderSize = parseInt(document.getElementById('maxOrderSize').value);
            const platform = document.getElementById('platform').value;
            
            const totalInvestment = totalUSDT * buyPrice;
            const maxUSDTPerOrder = maxOrderSize / sellPrice;
            const numberOfOrders = Math.ceil(totalUSDT / maxUSDTPerOrder);
            
            // Calculate fees
            const platformFees = {
                'Binance P2P': 0,
                'WazirX P2P': 0.002,
                'CoinDCX P2P': 0.001,
                'ZebPay P2P': 0.005,
                'Local P2P': 0
            };
            
            const platformFee = platformFees[platform] || 0;
            
            // Per order calculations
            const usdtPerOrder = totalUSDT / numberOfOrders;
            const revenuePerOrder = usdtPerOrder * sellPrice;
            const platformFeePerOrder = revenuePerOrder * platformFee;
            const netRevenuePerOrder = revenuePerOrder - platformFeePerOrder;
            
            // Total calculations
            const totalRevenue = netRevenuePerOrder * numberOfOrders;
            const totalProfit = totalRevenue - totalInvestment;
            const capitalGainsTax = totalProfit * 0.30;
            const netProfit = totalProfit - capitalGainsTax;
            const roi = (netProfit / totalInvestment) * 100;
            
            // TDS comparison
            const singleOrderTDS = totalRevenue > 50000 ? totalRevenue * 0.01 : 0;
            const splitOrderTDS = 0; // Each order < 50k
            const tdsSaved = singleOrderTDS - splitOrderTDS;
            
            return {
                numberOfOrders,
                totalRevenue,
                netProfit,
                roi,
                tdsSaved,
                usdtPerOrder,
                revenuePerOrder: netRevenuePerOrder,
                timeEstimate: numberOfOrders * 20 // 20 minutes per order
            };
        }

        function optimizeOrders() {
            const result = calculateOptimalOrders();
            
            // Update results
            document.getElementById('optimalOrders').textContent = result.numberOfOrders;
            document.getElementById('totalRevenue').textContent = `‚Çπ${result.totalRevenue.toLocaleString('en-IN')}`;
            document.getElementById('tdsSaved').textContent = `‚Çπ${result.tdsSaved.toLocaleString('en-IN')}`;
            document.getElementById('netProfit').textContent = `‚Çπ${result.netProfit.toLocaleString('en-IN')}`;
            document.getElementById('roi').textContent = `${result.roi.toFixed(2)}%`;
            document.getElementById('timeEstimate').textContent = `${Math.round(result.timeEstimate / 60)}h ${result.timeEstimate % 60}m`;
            
            // Show results
            document.getElementById('results').classList.add('show');
            
            // Update comparison table
            updateComparisonTable(result);
            
            // Update order suggestions
            updateOrderSuggestions(result);
            
            // Update current buy price with cheapest exchange
            updateBuyPriceWithCheapest();
        }

        function updateBuyPriceWithCheapest() {
            // Only consider ACTIVE exchanges
            const activeExchanges = Object.keys(exchangeData)
                .filter(exchange => exchangeData[exchange].status === 'active')
                .map(exchange => calculateEffectiveBuyPrice(exchange));
            
            if (activeExchanges.length === 0) {
                alert('‚ö†Ô∏è No active exchanges available for trading!');
                return;
            }
            
            // Sort by effective price (cheapest first)
            activeExchanges.sort((a, b) => a.effectivePrice - b.effectivePrice);
            
            const cheapest = activeExchanges[0];
            
            // Update the buy price input with the cheapest effective price
            document.getElementById('buyPrice').value = cheapest.effectivePrice.toFixed(2);
            
            // Show a notification
            const sellPrice = parseFloat(document.getElementById('sellPrice').value);
            const profitMargin = ((sellPrice - cheapest.effectivePrice) / cheapest.effectivePrice * 100).toFixed(2);
            
            // Add a margin indicator
            let marginColor = '#10b981';
            if (profitMargin < 2) marginColor = '#f59e0b';
            if (profitMargin < 1) marginColor = '#ef4444';
            
            const marginIndicator = document.createElement('div');
            marginIndicator.style.cssText = `
                background: ${marginColor};
                color: white;
                padding: 8px 15px;
                border-radius: 5px;
                margin-top: 10px;
                font-size: 0.9em;
                font-weight: bold;
                text-align: center;
            `;
            marginIndicator.textContent = `Using ${cheapest.exchange} (‚Çπ${cheapest.effectivePrice.toFixed(2)}) - Profit Margin: ${profitMargin}% [ACTIVE]`;
            
            // Remove existing margin indicator
            const existing = document.querySelector('#margin-indicator');
            if (existing) existing.remove();
            
            marginIndicator.id = 'margin-indicator';
            document.getElementById('buyPrice').parentNode.appendChild(marginIndicator);
        }

        function updateComparisonTable(optimized) {
            const totalUSDT = parseFloat(document.getElementById('totalUSDT').value);
            const buyPrice = parseFloat(document.getElementById('buyPrice').value);
            const sellPrice = parseFloat(document.getElementById('sellPrice').value);
            const totalInvestment = totalUSDT * buyPrice;
            
            // Single order strategy
            const singleRevenue = totalUSDT * sellPrice;
            const singleTDS = singleRevenue > 50000 ? singleRevenue * 0.01 : 0;
            const singleNetRevenue = singleRevenue - singleTDS;
            const singleProfit = singleNetRevenue - totalInvestment;
            const singleTax = singleProfit * 0.30;
            const singleNetProfit = singleProfit - singleTax;
            const singleROI = (singleNetProfit / totalInvestment) * 100;
            
            const tableBody = document.getElementById('comparisonTable');
            tableBody.innerHTML = `
                <tr>
                    <td>Single Order</td>
                    <td>1</td>
                    <td class="loss">‚Çπ${singleTDS.toLocaleString('en-IN')}</td>
                    <td>‚Çπ${singleNetRevenue.toLocaleString('en-IN')}</td>
                    <td>‚Çπ${singleNetProfit.toLocaleString('en-IN')}</td>
                    <td>${singleROI.toFixed(2)}%</td>
                </tr>
                <tr style="background: #065f46;">
                    <td>Optimized Split</td>
                    <td>${optimized.numberOfOrders}</td>
                    <td class="highlight">‚Çπ0</td>
                    <td>‚Çπ${optimized.totalRevenue.toLocaleString('en-IN')}</td>
                    <td class="profit">‚Çπ${optimized.netProfit.toLocaleString('en-IN')}</td>
                    <td class="profit">${optimized.roi.toFixed(2)}%</td>
                </tr>
                <tr style="background: #1e293b;">
                    <td><strong>Improvement</strong></td>
                    <td>+${optimized.numberOfOrders - 1}</td>
                    <td class="profit">+‚Çπ${optimized.tdsSaved.toLocaleString('en-IN')}</td>
                    <td>+‚Çπ${(optimized.totalRevenue - singleNetRevenue).toLocaleString('en-IN')}</td>
                    <td class="profit">+‚Çπ${(optimized.netProfit - singleNetProfit).toLocaleString('en-IN')}</td>
                    <td class="profit">+${(optimized.roi - singleROI).toFixed(2)}%</td>
                </tr>
            `;
        }

        function updateOrderSuggestions(result) {
            const orderList = document.getElementById('orderList');
            let html = '';
            
            for (let i = 1; i <= result.numberOfOrders; i++) {
                html += `
                    <div class="order-item">
                        <strong>Order ${i}:</strong> 
                        ${result.usdtPerOrder.toFixed(2)} USDT @ ‚Çπ${document.getElementById('sellPrice').value} = 
                        <span class="profit">‚Çπ${result.revenuePerOrder.toLocaleString('en-IN')}</span>
                        <span class="highlight">No TDS</span>
                    </div>
                `;
            }
            
            orderList.innerHTML = html;
        }

        // Initialize with default calculation
        window.onload = function() {
            updateExchangeRates();
            optimizeOrders();
            
            // Update rates every 30 seconds
            setInterval(() => {
                updateExchangeRates();
            }, 30000);
        };
    </script>
</body>
</html>