<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USDT Auto-Listing Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            padding: 20px;
            line-height: 1.6;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #1f6feb 0%, #388bfd 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(31, 111, 235, 0.3);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-active {
            background: #3fb950;
        }
        
        .status-inactive {
            background: #f85149;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            border-color: #58a6ff;
            box-shadow: 0 4px 16px rgba(88, 166, 255, 0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 1.2em;
            color: #58a6ff;
        }
        
        .balance-card {
            background: linear-gradient(135deg, #161b22 0%, #0d1117 100%);
            border: 2px solid #238636;
        }
        
        .balance-amount {
            font-size: 2.5em;
            font-weight: bold;
            color: #3fb950;
            margin: 10px 0;
        }
        
        .balance-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .detail-item {
            background: #0d1117;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .detail-label {
            font-size: 0.9em;
            color: #8b949e;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .orders-table {
            width: 100%;
            background: #161b22;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #30363d;
        }
        
        .table-header {
            background: #1f2428;
            padding: 15px 20px;
            font-weight: bold;
            color: #58a6ff;
            border-bottom: 1px solid #30363d;
        }
        
        .order-row {
            display: grid;
            grid-template-columns: auto 1fr 100px 100px 120px 100px;
            gap: 15px;
            padding: 15px 20px;
            border-bottom: 1px solid #21262d;
            align-items: center;
            transition: background 0.2s ease;
        }
        
        .order-row:hover {
            background: #1f2428;
        }
        
        .order-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #3fb950;
        }
        
        .order-id {
            font-family: monospace;
            font-size: 0.9em;
            color: #8b949e;
        }
        
        .order-amount {
            font-weight: bold;
        }
        
        .order-price {
            color: #58a6ff;
        }
        
        .order-expiry {
            font-size: 0.9em;
            color: #f0883e;
        }
        
        .relist-count {
            background: #1f2428;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
        }
        
        .controls {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .control-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .control-label {
            font-size: 0.9em;
            color: #8b949e;
        }
        
        .control-input {
            background: #0d1117;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 1em;
        }
        
        .control-input:focus {
            outline: none;
            border-color: #58a6ff;
        }
        
        .button {
            background: #238636;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .button:hover {
            background: #2ea043;
        }
        
        .button:disabled {
            background: #30363d;
            cursor: not-allowed;
        }
        
        .button-danger {
            background: #da3633;
        }
        
        .button-danger:hover {
            background: #f85149;
        }
        
        .log-container {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #21262d;
        }
        
        .log-time {
            color: #8b949e;
            margin-right: 10px;
        }
        
        .log-success {
            color: #3fb950;
        }
        
        .log-error {
            color: #f85149;
        }
        
        .log-warning {
            color: #f0883e;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #0d1117;
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #58a6ff;
        }
        
        .stat-label {
            font-size: 0.9em;
            color: #8b949e;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>ü§ñ USDT Auto-Listing Dashboard</h1>
            <p>
                <span class="status-indicator status-active" id="statusIndicator"></span>
                <span id="statusText">System Active</span>
                <span style="float: right; font-size: 0.9em;" id="lastUpdate">Last update: --:--:--</span>
            </p>
        </div>
        
        <div class="controls">
            <h3 style="margin-bottom: 15px;">‚öôÔ∏è Configuration</h3>
            <div class="control-grid">
                <div class="control-item">
                    <label class="control-label">Max Orders</label>
                    <input type="number" class="control-input" id="maxOrders" value="3" min="1" max="10">
                </div>
                <div class="control-item">
                    <label class="control-label">Price Strategy</label>
                    <select class="control-input" id="priceStrategy">
                        <option value="competitive">Competitive</option>
                        <option value="fixed">Fixed</option>
                        <option value="dynamic">Dynamic</option>
                    </select>
                </div>
                <div class="control-item">
                    <label class="control-label">Price Offset (%)</label>
                    <input type="number" class="control-input" id="priceOffset" value="0.3" min="0.1" max="5" step="0.1">
                </div>
                <div class="control-item">
                    <label class="control-label">Order Expiry (min)</label>
                    <input type="number" class="control-input" id="expiryTime" value="15" min="5" max="60">
                </div>
            </div>
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button class="button" onclick="updateConfig()">Update Config</button>
                <button class="button" onclick="startSystem()">Start</button>
                <button class="button button-danger" onclick="stopSystem()">Stop</button>
            </div>
        </div>
        
        <div class="grid">
            <div class="card balance-card">
                <div class="card-header">
                    <h3 class="card-title">üí∞ USDT Balance</h3>
                </div>
                <div class="balance-amount" id="totalBalance">11.5 USDT</div>
                <div class="balance-details">
                    <div class="detail-item">
                        <div class="detail-label">Available</div>
                        <div class="detail-value" id="availableBalance">11.5</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Locked</div>
                        <div class="detail-value" id="lockedBalance">0</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Spot</div>
                        <div class="detail-value" id="spotBalance">11.5</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">P2P</div>
                        <div class="detail-value" id="p2pBalance">0</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìä Market Status</h3>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Current Market Price</div>
                    <div class="detail-value" id="marketPrice">‚Çπ90.00</div>
                </div>
                <div class="detail-item" style="margin-top: 10px;">
                    <div class="detail-label">Your Buy Price</div>
                    <div class="detail-value">‚Çπ89.00</div>
                </div>
                <div class="detail-item" style="margin-top: 10px;">
                    <div class="detail-label">Target Profit</div>
                    <div class="detail-value" id="targetProfit">1.12%</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìà Statistics</h3>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalOrders">0</div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="activeOrders">0</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="completedOrders">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="relistCount">0</div>
                        <div class="stat-label">Relisted</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="orders-table">
            <div class="table-header">
                üìã Active Orders
            </div>
            <div id="ordersContainer">
                <div class="order-row" style="justify-content: center; color: #8b949e;">
                    <p>No active orders</p>
                </div>
            </div>
        </div>
        
        <div class="card" style="margin-top: 30px;">
            <div class="card-header">
                <h3 class="card-title">üìú Activity Log</h3>
                <button class="button" onclick="clearLog()" style="padding: 5px 10px; font-size: 0.9em;">Clear</button>
            </div>
            <div class="log-container" id="logContainer">
                <div class="log-entry">
                    <span class="log-time">--:--:--</span>
                    <span>Waiting for system start...</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Mock data for demonstration
        let isRunning = false;
        let mockOrders = [];
        let stats = {
            total: 0,
            active: 0,
            completed: 0,
            relisted: 0
        };
        
        // Update functions
        function updateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `Last update: ${now.toLocaleTimeString()}`;
        }
        
        function addLog(message, type = 'info') {
            const container = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const time = new Date().toLocaleTimeString();
            const colorClass = type === 'success' ? 'log-success' : 
                              type === 'error' ? 'log-error' : 
                              type === 'warning' ? 'log-warning' : '';
            
            entry.innerHTML = `
                <span class="log-time">${time}</span>
                <span class="${colorClass}">${message}</span>
            `;
            
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }
        
        function updateBalance(total, available, locked) {
            document.getElementById('totalBalance').textContent = `${total} USDT`;
            document.getElementById('availableBalance').textContent = available.toFixed(2);
            document.getElementById('lockedBalance').textContent = locked.toFixed(2);
            document.getElementById('spotBalance').textContent = available.toFixed(2);
            document.getElementById('p2pBalance').textContent = locked.toFixed(2);
        }
        
        function updateOrders() {
            const container = document.getElementById('ordersContainer');
            
            if (mockOrders.length === 0) {
                container.innerHTML = `
                    <div class="order-row" style="justify-content: center; color: #8b949e;">
                        <p>No active orders</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = mockOrders.map(order => `
                <div class="order-row">
                    <div class="order-status"></div>
                    <div class="order-id">${order.id}</div>
                    <div class="order-amount">${order.amount} USDT</div>
                    <div class="order-price">‚Çπ${order.price}</div>
                    <div class="order-expiry">Expires in ${order.expiresIn}m</div>
                    <div class="relist-count">Relist: ${order.relistCount}</div>
                </div>
            `).join('');
        }
        
        function updateStats() {
            document.getElementById('totalOrders').textContent = stats.total;
            document.getElementById('activeOrders').textContent = stats.active;
            document.getElementById('completedOrders').textContent = stats.completed;
            document.getElementById('relistCount').textContent = stats.relisted;
        }
        
        function updateMarketPrice(price) {
            document.getElementById('marketPrice').textContent = `‚Çπ${price.toFixed(2)}`;
            const profit = ((price - 89) / 89 * 100).toFixed(2);
            document.getElementById('targetProfit').textContent = `${profit}%`;
        }
        
        // Control functions
        function updateConfig() {
            const config = {
                maxOrders: document.getElementById('maxOrders').value,
                priceStrategy: document.getElementById('priceStrategy').value,
                priceOffset: document.getElementById('priceOffset').value,
                expiryTime: document.getElementById('expiryTime').value
            };
            
            addLog(`Configuration updated: ${JSON.stringify(config)}`, 'success');
            
            // Send to backend
            fetch('http://localhost:4000/api/auto-listing/config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(config)
            }).catch(err => {
                addLog('Failed to update config: ' + err.message, 'error');
            });
        }
        
        function startSystem() {
            isRunning = true;
            document.getElementById('statusIndicator').className = 'status-indicator status-active';
            document.getElementById('statusText').textContent = 'System Active';
            addLog('Auto-listing system started', 'success');
            
            // Start mock data generation
            simulateActivity();
            
            // Send to backend
            fetch('http://localhost:4000/api/auto-listing/start', { method: 'POST' })
                .catch(err => {
                    addLog('Failed to start: ' + err.message, 'error');
                });
        }
        
        function stopSystem() {
            isRunning = false;
            document.getElementById('statusIndicator').className = 'status-indicator status-inactive';
            document.getElementById('statusText').textContent = 'System Stopped';
            addLog('Auto-listing system stopped', 'warning');
            
            // Send to backend
            fetch('http://localhost:4000/api/auto-listing/stop', { method: 'POST' })
                .catch(err => {
                    addLog('Failed to stop: ' + err.message, 'error');
                });
        }
        
        function clearLog() {
            document.getElementById('logContainer').innerHTML = '';
            addLog('Log cleared');
        }
        
        // Simulation for demonstration
        function simulateActivity() {
            if (!isRunning) return;
            
            // Simulate balance updates
            const available = 11.5 - (mockOrders.length * 11.5 / 3);
            const locked = mockOrders.length * 11.5 / 3;
            updateBalance(11.5, available, locked);
            
            // Simulate order creation
            if (mockOrders.length < 3 && Math.random() > 0.7) {
                const orderId = `binance_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`;
                const price = 89.5 + Math.random() * 1.5;
                
                mockOrders.push({
                    id: orderId,
                    amount: 11.5 / 3,
                    price: price.toFixed(2),
                    expiresIn: 15,
                    relistCount: 0
                });
                
                stats.total++;
                stats.active = mockOrders.length;
                
                addLog(`Order created: ${(11.5/3).toFixed(2)} USDT @ ‚Çπ${price.toFixed(2)}`, 'success');
                updateOrders();
                updateStats();
            }
            
            // Simulate order expiry and relisting
            mockOrders = mockOrders.map(order => {
                order.expiresIn--;
                
                if (order.expiresIn <= 0) {
                    addLog(`Order expired: ${order.id}`, 'warning');
                    
                    // Relist
                    const newPrice = parseFloat(order.price) - 0.2;
                    order.price = newPrice.toFixed(2);
                    order.expiresIn = 15;
                    order.relistCount++;
                    stats.relisted++;
                    
                    addLog(`Order relisted at ‚Çπ${newPrice.toFixed(2)}`, 'success');
                }
                
                return order;
            });
            
            // Simulate order completion
            if (mockOrders.length > 0 && Math.random() > 0.9) {
                const completed = mockOrders.shift();
                stats.completed++;
                stats.active = mockOrders.length;
                
                addLog(`Order completed: ${completed.amount} USDT sold at ‚Çπ${completed.price}`, 'success');
                updateOrders();
                updateStats();
            }
            
            // Update market price
            updateMarketPrice(90 + Math.random() * 2);
            
            updateOrders();
            updateTime();
            
            // Continue simulation
            setTimeout(simulateActivity, 5000);
        }
        
        // Initial setup
        updateTime();
        setInterval(updateTime, 1000);
        
        // Connect to backend for real data
        async function connectToBackend() {
            try {
                const response = await fetch('http://localhost:4000/api/auto-listing/status');
                const data = await response.json();
                
                if (data.success) {
                    // Update UI with real data
                    updateBalance(data.balance.total, data.balance.available, data.balance.locked);
                    // Update other fields...
                }
            } catch (err) {
                console.error('Backend connection failed:', err);
            }
        }
        
        // Try to connect every 5 seconds
        setInterval(connectToBackend, 5000);
    </script>
</body>
</html>