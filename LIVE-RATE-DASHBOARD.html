<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live USDT/INR Rate Dashboard</title>
    <style>
        :root {
            --primary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #0f0f0f;
            --card: #1a1a1a;
            --card-hover: #252525;
            --text: #e0e0e0;
            --text-dim: #999;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark);
            color: var(--text);
            padding: 20px;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: var(--card);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .dashboard-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: var(--card);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .metric-label {
            color: var(--text-dim);
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .metric-value.up {
            color: var(--success);
        }

        .metric-value.down {
            color: var(--danger);
        }

        .rates-container {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .exchange-rate-card {
            background: var(--card);
            border-radius: 15px;
            padding: 20px;
            display: grid;
            grid-template-columns: 150px 1fr auto;
            gap: 20px;
            align-items: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .exchange-rate-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        .exchange-rate-card:hover::before {
            width: 8px;
        }

        .exchange-rate-card.updating {
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .exchange-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .exchange-name {
            font-size: 1.2em;
            font-weight: bold;
        }

        .exchange-status {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--text-dim);
            font-size: 0.9em;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--danger);
        }

        .status-dot.connected {
            background: var(--success);
        }

        .price-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .price-item {
            text-align: center;
        }

        .price-label {
            color: var(--text-dim);
            font-size: 0.8em;
            margin-bottom: 3px;
        }

        .price-value {
            font-weight: bold;
            font-size: 1.1em;
            font-family: 'Courier New', monospace;
        }

        .rate-chart {
            width: 200px;
            height: 60px;
            position: relative;
        }

        .mini-chart {
            width: 100%;
            height: 100%;
        }

        .arbitrage-section {
            background: var(--card);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .arbitrage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .arbitrage-list {
            display: grid;
            gap: 15px;
        }

        .arbitrage-item {
            background: var(--card-hover);
            border-radius: 10px;
            padding: 15px;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid var(--success);
        }

        .arbitrage-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.2);
        }

        .arbitrage-route {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .route-arrow {
            font-size: 1.5em;
            color: var(--primary);
        }

        .profit-info {
            text-align: right;
        }

        .profit-percentage {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--success);
        }

        .profit-amount {
            color: var(--text-dim);
            font-size: 0.9em;
        }

        .controls {
            background: var(--card);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input, select {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: var(--card-hover);
            color: var(--text);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--primary);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn.success {
            background: var(--success);
        }

        .btn.danger {
            background: var(--danger);
        }

        .alert-config {
            background: var(--card);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--text-dim);
        }

        .loading::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .sparkline {
            stroke: var(--primary);
            fill: none;
            stroke-width: 2;
        }

        .sparkline-area {
            fill: rgba(52, 152, 219, 0.1);
        }

        @media (max-width: 768px) {
            .exchange-rate-card {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .rate-chart {
                width: 100%;
            }
            
            .arbitrage-route {
                flex-direction: column;
                gap: 5px;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <h1>Live USDT/INR Rate Dashboard</h1>
        <p>Real-time exchange rates and arbitrage opportunities</p>
    </div>

    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-label">Active Exchanges</div>
            <div class="metric-value" id="activeExchanges">0/4</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Average Price</div>
            <div class="metric-value" id="avgPrice">₹--</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Best Spread</div>
            <div class="metric-value up" id="bestSpread">--%</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Opportunities</div>
            <div class="metric-value" id="oppCount">0</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Update Rate</div>
            <div class="metric-value" id="updateRate">3s</div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Last Update</div>
            <div class="metric-value" id="lastUpdate">--:--:--</div>
        </div>
    </div>

    <div class="controls">
        <div class="control-group">
            <label>Volume (INR):</label>
            <input type="number" id="volumeInput" value="49900" min="1000" max="50000">
        </div>
        <div class="control-group">
            <label>Update Interval:</label>
            <select id="intervalSelect">
                <option value="1000">1 second</option>
                <option value="3000" selected>3 seconds</option>
                <option value="5000">5 seconds</option>
                <option value="10000">10 seconds</option>
            </select>
        </div>
        <div class="control-group">
            <label>Min Profit %:</label>
            <input type="number" id="minProfitInput" value="0.5" min="0" max="10" step="0.1">
        </div>
        <button class="btn" id="refreshBtn" onclick="refreshRates()">Refresh Now</button>
        <button class="btn success" id="autoRefreshBtn" onclick="toggleAutoRefresh()">Auto Refresh: ON</button>
    </div>

    <div class="rates-container" id="ratesContainer">
        <div class="loading">Loading exchange rates</div>
    </div>

    <div class="arbitrage-section">
        <div class="arbitrage-header">
            <h2>Arbitrage Opportunities</h2>
            <span id="arbStatus" style="color: var(--text-dim);">Scanning...</span>
        </div>
        <div class="arbitrage-list" id="arbitrageList">
            <div class="loading">Calculating opportunities</div>
        </div>
    </div>

    <div class="alert-config">
        <h3>Alert Configuration</h3>
        <div class="controls">
            <div class="control-group">
                <label>Alert Threshold %:</label>
                <input type="number" id="alertThreshold" value="1.0" min="0" max="10" step="0.1">
            </div>
            <div class="control-group">
                <label>Sound Alerts:</label>
                <input type="checkbox" id="soundAlerts" checked>
            </div>
            <div class="control-group">
                <label>Desktop Notifications:</label>
                <input type="checkbox" id="desktopNotifications">
            </div>
            <button class="btn" onclick="testAlert()">Test Alert</button>
        </div>
    </div>

    <script>
        // State
        let rates = new Map();
        let priceHistory = new Map();
        let autoRefresh = true;
        let refreshTimer = null;
        let updateInterval = 3000;

        // Mock exchange data
        const EXCHANGES = [
            { id: 'binance', name: 'Binance', color: '#f0b90b' },
            { id: 'zebpay', name: 'ZebPay', color: '#0052cc' },
            { id: 'kucoin', name: 'KuCoin', color: '#23af91' },
            { id: 'coinswitch', name: 'CoinSwitch', color: '#ff6b6b' }
        ];

        // Initialize
        function init() {
            setupEventListeners();
            requestNotificationPermission();
            createExchangeCards();
            startAutoRefresh();
        }

        // Create exchange rate cards
        function createExchangeCards() {
            const container = document.getElementById('ratesContainer');
            container.innerHTML = '';

            EXCHANGES.forEach(exchange => {
                const card = document.createElement('div');
                card.className = 'exchange-rate-card';
                card.id = `card-${exchange.id}`;
                card.innerHTML = `
                    <div class="exchange-info">
                        <div class="exchange-name" style="color: ${exchange.color}">${exchange.name}</div>
                        <div class="exchange-status">
                            <div class="status-dot" id="status-${exchange.id}"></div>
                            <span id="status-text-${exchange.id}">Connecting...</span>
                        </div>
                    </div>
                    <div class="price-grid">
                        <div class="price-item">
                            <div class="price-label">Bid</div>
                            <div class="price-value" id="bid-${exchange.id}">--</div>
                        </div>
                        <div class="price-item">
                            <div class="price-label">Ask</div>
                            <div class="price-value" id="ask-${exchange.id}">--</div>
                        </div>
                        <div class="price-item">
                            <div class="price-label">Last</div>
                            <div class="price-value" id="last-${exchange.id}">--</div>
                        </div>
                    </div>
                    <div class="rate-chart">
                        <svg class="mini-chart" id="chart-${exchange.id}">
                            <path class="sparkline-area" d=""></path>
                            <path class="sparkline" d=""></path>
                        </svg>
                    </div>
                `;
                container.appendChild(card);

                // Initialize price history
                priceHistory.set(exchange.id, []);
            });
        }

        // Simulate fetching rates
        async function fetchRates() {
            const basePrice = 87.5 + (Math.random() * 0.5 - 0.25);
            
            EXCHANGES.forEach(exchange => {
                // Simulate different prices for each exchange
                const variation = (Math.random() * 0.3 - 0.15);
                const price = basePrice + variation;
                const spread = 0.05 + (Math.random() * 0.05);
                
                const rate = {
                    exchange: exchange.id,
                    bid: price - spread,
                    ask: price + spread,
                    last: price,
                    timestamp: new Date()
                };
                
                // Update rate
                rates.set(exchange.id, rate);
                
                // Update history
                const history = priceHistory.get(exchange.id);
                history.push(price);
                if (history.length > 20) history.shift();
                
                // Update UI
                updateExchangeCard(exchange.id, rate);
                updateSparkline(exchange.id, history);
            });
            
            updateMetrics();
            findArbitrage();
        }

        // Update exchange card
        function updateExchangeCard(exchangeId, rate) {
            const card = document.getElementById(`card-${exchangeId}`);
            card.classList.add('updating');
            setTimeout(() => card.classList.remove('updating'), 300);
            
            document.getElementById(`bid-${exchangeId}`).textContent = `₹${rate.bid.toFixed(2)}`;
            document.getElementById(`ask-${exchangeId}`).textContent = `₹${rate.ask.toFixed(2)}`;
            document.getElementById(`last-${exchangeId}`).textContent = `₹${rate.last.toFixed(2)}`;
            
            // Update status
            const statusDot = document.getElementById(`status-${exchangeId}`);
            const statusText = document.getElementById(`status-text-${exchangeId}`);
            statusDot.classList.add('connected');
            statusText.textContent = 'Connected';
        }

        // Update sparkline chart
        function updateSparkline(exchangeId, history) {
            if (history.length < 2) return;
            
            const svg = document.getElementById(`chart-${exchangeId}`);
            const width = 200;
            const height = 60;
            const padding = 5;
            
            const min = Math.min(...history);
            const max = Math.max(...history);
            const range = max - min || 1;
            
            const points = history.map((price, i) => {
                const x = (i / (history.length - 1)) * (width - 2 * padding) + padding;
                const y = height - ((price - min) / range) * (height - 2 * padding) - padding;
                return `${x},${y}`;
            }).join(' ');
            
            const areaPoints = `${padding},${height} ${points} ${width - padding},${height}`;
            
            svg.querySelector('.sparkline').setAttribute('d', `M ${points}`);
            svg.querySelector('.sparkline-area').setAttribute('d', `M ${padding},${height} L ${points} L ${width - padding},${height} Z`);
        }

        // Update metrics
        function updateMetrics() {
            const activeCount = rates.size;
            document.getElementById('activeExchanges').textContent = `${activeCount}/4`;
            
            if (activeCount > 0) {
                const prices = Array.from(rates.values()).map(r => r.last);
                const avgPrice = prices.reduce((sum, p) => sum + p, 0) / prices.length;
                document.getElementById('avgPrice').textContent = `₹${avgPrice.toFixed(2)}`;
                
                const bestBuy = Math.min(...Array.from(rates.values()).map(r => r.ask));
                const bestSell = Math.max(...Array.from(rates.values()).map(r => r.bid));
                const bestSpread = ((bestSell - bestBuy) / bestBuy * 100).toFixed(2);
                document.getElementById('bestSpread').textContent = `${bestSpread}%`;
            }
            
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
        }

        // Find arbitrage opportunities
        function findArbitrage() {
            const opportunities = [];
            const rateArray = Array.from(rates.values());
            const minProfit = parseFloat(document.getElementById('minProfitInput').value);
            const volume = parseFloat(document.getElementById('volumeInput').value);
            
            for (let i = 0; i < rateArray.length; i++) {
                for (let j = 0; j < rateArray.length; j++) {
                    if (i === j) continue;
                    
                    const buyRate = rateArray[i];
                    const sellRate = rateArray[j];
                    
                    const profitPercentage = ((sellRate.bid - buyRate.ask) / buyRate.ask) * 100;
                    
                    if (profitPercentage >= minProfit) {
                        const quantity = volume / buyRate.ask;
                        const profit = (sellRate.bid - buyRate.ask) * quantity * 0.998; // Approximate fees
                        
                        opportunities.push({
                            buyExchange: EXCHANGES.find(e => e.id === buyRate.exchange).name,
                            sellExchange: EXCHANGES.find(e => e.id === sellRate.exchange).name,
                            buyPrice: buyRate.ask,
                            sellPrice: sellRate.bid,
                            profit: profit,
                            profitPercentage: profitPercentage
                        });
                    }
                }
            }
            
            // Sort by profit
            opportunities.sort((a, b) => b.profitPercentage - a.profitPercentage);
            
            // Update UI
            displayArbitrage(opportunities);
            document.getElementById('oppCount').textContent = opportunities.length;
            
            // Alert if high profit found
            const alertThreshold = parseFloat(document.getElementById('alertThreshold').value);
            if (opportunities.length > 0 && opportunities[0].profitPercentage >= alertThreshold) {
                triggerAlert(opportunities[0]);
            }
        }

        // Display arbitrage opportunities
        function displayArbitrage(opportunities) {
            const container = document.getElementById('arbitrageList');
            
            if (opportunities.length === 0) {
                container.innerHTML = '<div class="loading">No profitable opportunities at current thresholds</div>';
                document.getElementById('arbStatus').textContent = 'No opportunities';
                return;
            }
            
            document.getElementById('arbStatus').textContent = `${opportunities.length} found`;
            
            container.innerHTML = opportunities.slice(0, 5).map(opp => `
                <div class="arbitrage-item" onclick="showArbitrageDetails('${opp.buyExchange}', '${opp.sellExchange}')">
                    <div class="arbitrage-route">
                        <div>
                            <strong>${opp.buyExchange}</strong>
                            <div style="color: var(--text-dim); font-size: 0.9em;">Buy @ ₹${opp.buyPrice.toFixed(2)}</div>
                        </div>
                        <div class="route-arrow">→</div>
                        <div>
                            <strong>${opp.sellExchange}</strong>
                            <div style="color: var(--text-dim); font-size: 0.9em;">Sell @ ₹${opp.sellPrice.toFixed(2)}</div>
                        </div>
                    </div>
                    <div class="profit-info">
                        <div class="profit-percentage">${opp.profitPercentage.toFixed(2)}%</div>
                        <div class="profit-amount">₹${opp.profit.toFixed(2)}</div>
                    </div>
                </div>
            `).join('');
        }

        // Alert functions
        function triggerAlert(opportunity) {
            // Sound alert
            if (document.getElementById('soundAlerts').checked) {
                playAlertSound();
            }
            
            // Desktop notification
            if (document.getElementById('desktopNotifications').checked) {
                showNotification(opportunity);
            }
        }

        function playAlertSound() {
            const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUazi');
            audio.play();
        }

        function showNotification(opportunity) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('High Profit Arbitrage Alert!', {
                    body: `${opportunity.buyExchange} → ${opportunity.sellExchange}: ${opportunity.profitPercentage.toFixed(2)}% profit`,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2327ae60"><path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/></svg>'
                });
            }
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        // Control functions
        function refreshRates() {
            fetchRates();
        }

        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const btn = document.getElementById('autoRefreshBtn');
            
            if (autoRefresh) {
                btn.textContent = 'Auto Refresh: ON';
                btn.className = 'btn success';
                startAutoRefresh();
            } else {
                btn.textContent = 'Auto Refresh: OFF';
                btn.className = 'btn danger';
                stopAutoRefresh();
            }
        }

        function startAutoRefresh() {
            if (!autoRefresh) return;
            
            fetchRates();
            refreshTimer = setInterval(fetchRates, updateInterval);
        }

        function stopAutoRefresh() {
            if (refreshTimer) {
                clearInterval(refreshTimer);
                refreshTimer = null;
            }
        }

        function testAlert() {
            triggerAlert({
                buyExchange: 'Test Exchange A',
                sellExchange: 'Test Exchange B',
                profitPercentage: 2.5
            });
        }

        function showArbitrageDetails(buyExchange, sellExchange) {
            alert(`Arbitrage Route Details:\n\nBuy from: ${buyExchange}\nSell to: ${sellExchange}\n\nTo execute this trade:\n1. Buy USDT on ${buyExchange}\n2. Transfer to ${sellExchange}\n3. Sell USDT on ${sellExchange}\n\nEstimated time: 10-15 minutes`);
        }

        // Event listeners
        function setupEventListeners() {
            document.getElementById('intervalSelect').addEventListener('change', (e) => {
                updateInterval = parseInt(e.target.value);
                document.getElementById('updateRate').textContent = `${updateInterval / 1000}s`;
                
                if (autoRefresh) {
                    stopAutoRefresh();
                    startAutoRefresh();
                }
            });
            
            document.getElementById('volumeInput').addEventListener('change', findArbitrage);
            document.getElementById('minProfitInput').addEventListener('change', findArbitrage);
        }

        // Initialize on load
        init();
    </script>
</body>
</html>