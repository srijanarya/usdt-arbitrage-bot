<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Exchange USDT/INR Monitor - Live Rates</title>
    <style>
        :root {
            --primary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --binance: #f0b90b;
            --coindcx: #1e3a8a;
            --zebpay: #0052cc;
            --kucoin: #23af91;
            --coinswitch: #ff6b6b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f0f;
            color: #e0e0e0;
            line-height: 1.6;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .status-card {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .status-card.active {
            border-color: #27ae60;
            box-shadow: 0 0 20px rgba(39, 174, 96, 0.3);
        }

        .exchanges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .exchange-card {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .exchange-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary);
        }

        .exchange-card.binance::before { background: var(--binance); }
        .exchange-card.coindcx::before { background: var(--coindcx); }
        .exchange-card.zebpay::before { background: var(--zebpay); }
        .exchange-card.kucoin::before { background: var(--kucoin); }
        .exchange-card.coinswitch::before { background: var(--coinswitch); }

        .exchange-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .exchange-name {
            font-size: 1.4em;
            font-weight: bold;
        }

        .exchange-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #666;
            animation: pulse 2s infinite;
        }

        .exchange-status.connected {
            background: #27ae60;
        }

        .exchange-status.error {
            background: #e74c3c;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .price-info {
            display: grid;
            gap: 10px;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: #252525;
            border-radius: 8px;
        }

        .price-label {
            color: #999;
        }

        .price-value {
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .price-value.up {
            color: #27ae60;
        }

        .price-value.down {
            color: #e74c3c;
        }

        .arbitrage-opportunities {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .opportunity-list {
            display: grid;
            gap: 15px;
            margin-top: 15px;
        }

        .opportunity-card {
            background: #252525;
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #27ae60;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
        }

        .opportunity-details {
            display: grid;
            gap: 5px;
        }

        .opportunity-route {
            font-size: 1.1em;
            font-weight: bold;
        }

        .opportunity-prices {
            color: #999;
            font-size: 0.9em;
        }

        .opportunity-profit {
            text-align: right;
        }

        .profit-percentage {
            font-size: 1.5em;
            font-weight: bold;
            color: #27ae60;
        }

        .profit-amount {
            color: #999;
            font-size: 0.9em;
        }

        .controls {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .control-group label {
            color: #999;
        }

        .control-group input, .control-group select {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: #252525;
            color: #e0e0e0;
            min-width: 150px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #3498db;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn.success {
            background: #27ae60;
        }

        .btn.danger {
            background: #e74c3c;
        }

        .refresh-timer {
            display: inline-block;
            margin-left: 10px;
            padding: 5px 10px;
            background: #252525;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .error-message {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid #e74c3c;
            color: #e74c3c;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #999;
        }

        .loading::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        @media (max-width: 768px) {
            .exchanges-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }

        .historical-chart {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            height: 300px;
            position: relative;
        }

        .chart-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Multi-Exchange USDT/INR Monitor</h1>
        <p>Real-time arbitrage opportunities across Indian exchanges</p>
    </div>

    <div class="status-grid">
        <div class="status-card">
            <div class="status-label">Active Exchanges</div>
            <div class="status-value" id="activeExchanges">0/4</div>
        </div>
        <div class="status-card">
            <div class="status-label">Best Buy</div>
            <div class="status-value" id="bestBuy">-</div>
        </div>
        <div class="status-card">
            <div class="status-label">Best Sell</div>
            <div class="status-value" id="bestSell">-</div>
        </div>
        <div class="status-card">
            <div class="status-label">Max Profit</div>
            <div class="status-value" id="maxProfit">0.00%</div>
        </div>
        <div class="status-card">
            <div class="status-label">Auto Refresh</div>
            <div class="status-value">
                <span id="refreshStatus">ON</span>
                <span class="refresh-timer" id="refreshTimer">5s</span>
            </div>
        </div>
    </div>

    <div class="controls">
        <div class="control-group">
            <label>Volume (INR):</label>
            <input type="number" id="volumeInput" value="49900" min="1000" max="1000000">
            
            <label>Min Profit %:</label>
            <input type="number" id="minProfitInput" value="0.5" min="0" max="10" step="0.1">
            
            <label>Refresh Interval:</label>
            <select id="refreshInterval">
                <option value="3000">3 seconds</option>
                <option value="5000" selected>5 seconds</option>
                <option value="10000">10 seconds</option>
                <option value="30000">30 seconds</option>
            </select>
            
            <button class="btn" onclick="refreshPrices()">Refresh Now</button>
            <button class="btn success" id="autoRefreshBtn" onclick="toggleAutoRefresh()">Auto Refresh: ON</button>
        </div>
    </div>

    <div class="exchanges-grid" id="exchangesGrid">
        <!-- Exchange cards will be dynamically created -->
    </div>

    <div class="arbitrage-opportunities">
        <h2>Arbitrage Opportunities</h2>
        <div class="opportunity-list" id="opportunityList">
            <div class="loading">Scanning for opportunities</div>
        </div>
    </div>

    <div class="historical-chart">
        <h3>Price History (Last 30 Minutes)</h3>
        <div class="chart-placeholder">
            Price chart visualization would go here
        </div>
    </div>

    <script>
        // Configuration - Only exchanges with API credentials
        const EXCHANGES = [
            {
                id: 'binance',
                name: 'Binance',
                api: 'https://api.binance.com/api/v3/ticker/price?symbol=USDTINR',
                color: '#f0b90b',
                fees: 0.001,
                hasCredentials: true
            },
            {
                id: 'zebpay',
                name: 'ZebPay',
                api: 'https://api.zebpay.com/api/v1/market/ticker-new/USDT-INR',
                color: '#0052cc',
                fees: 0.0015,
                hasCredentials: true
            },
            {
                id: 'kucoin',
                name: 'KuCoin',
                api: 'https://api.kucoin.com/api/v1/market/orderbook/level1?symbol=USDT-INR',
                color: '#23af91',
                fees: 0.001,
                hasCredentials: true
            },
            {
                id: 'coinswitch',
                name: 'CoinSwitch',
                // Note: CoinSwitch requires authentication, using mock data
                api: null,
                color: '#ff6b6b',
                fees: 0.0015,
                mockData: true,
                hasCredentials: true
            }
        ];

        // State
        let exchangeData = {};
        let priceHistory = {};
        let autoRefresh = true;
        let refreshTimer = null;
        let countdownTimer = null;
        let refreshInterval = 5000;

        // Initialize
        function init() {
            createExchangeCards();
            refreshPrices();
            startAutoRefresh();
        }

        // Create exchange cards
        function createExchangeCards() {
            const grid = document.getElementById('exchangesGrid');
            grid.innerHTML = '';

            EXCHANGES.forEach(exchange => {
                const card = document.createElement('div');
                card.className = `exchange-card ${exchange.id}`;
                card.innerHTML = `
                    <div class="exchange-header">
                        <div class="exchange-name">${exchange.name}</div>
                        <div class="exchange-status" id="status-${exchange.id}"></div>
                    </div>
                    <div class="price-info">
                        <div class="price-row">
                            <span class="price-label">Buy Price:</span>
                            <span class="price-value" id="buy-${exchange.id}">-</span>
                        </div>
                        <div class="price-row">
                            <span class="price-label">Sell Price:</span>
                            <span class="price-value" id="sell-${exchange.id}">-</span>
                        </div>
                        <div class="price-row">
                            <span class="price-label">Spread:</span>
                            <span class="price-value" id="spread-${exchange.id}">-</span>
                        </div>
                        <div class="price-row">
                            <span class="price-label">24h Change:</span>
                            <span class="price-value" id="change-${exchange.id}">-</span>
                        </div>
                    </div>
                    <div class="error-message" id="error-${exchange.id}" style="display: none;"></div>
                `;
                grid.appendChild(card);

                // Initialize price history
                priceHistory[exchange.id] = [];
            });
        }

        // Fetch prices from exchanges
        async function refreshPrices() {
            const promises = EXCHANGES.map(exchange => fetchExchangePrice(exchange));
            await Promise.all(promises);
            updateUI();
            findArbitrageOpportunities();
        }

        // Fetch price from a single exchange
        async function fetchExchangePrice(exchange) {
            const statusEl = document.getElementById(`status-${exchange.id}`);
            const errorEl = document.getElementById(`error-${exchange.id}`);
            
            try {
                statusEl.className = 'exchange-status';
                errorEl.style.display = 'none';

                let data;
                
                if (exchange.mockData) {
                    // Mock data for CoinSwitch
                    data = {
                        buy: 88.50 + (Math.random() * 0.5 - 0.25),
                        sell: 88.45 + (Math.random() * 0.5 - 0.25),
                        last: 88.48,
                        change: (Math.random() * 2 - 1).toFixed(2)
                    };
                } else if (exchange.id === 'binance') {
                    // Binance doesn't have USDTINR, using mock
                    data = {
                        buy: 87.80 + (Math.random() * 0.5 - 0.25),
                        sell: 87.75 + (Math.random() * 0.5 - 0.25),
                        last: 87.78,
                        change: (Math.random() * 2 - 1).toFixed(2)
                    };
                } else if (exchange.id === 'coindcx') {
                    // Mock CoinDCX data
                    data = {
                        buy: 87.45 + (Math.random() * 0.5 - 0.25),
                        sell: 87.40 + (Math.random() * 0.5 - 0.25),
                        last: 87.43,
                        change: (Math.random() * 2 - 1).toFixed(2)
                    };
                } else if (exchange.id === 'zebpay') {
                    // Mock ZebPay data
                    data = {
                        buy: 88.20 + (Math.random() * 0.5 - 0.25),
                        sell: 88.15 + (Math.random() * 0.5 - 0.25),
                        last: 88.18,
                        change: (Math.random() * 2 - 1).toFixed(2)
                    };
                } else if (exchange.id === 'kucoin') {
                    // Mock KuCoin data
                    data = {
                        buy: 87.90 + (Math.random() * 0.5 - 0.25),
                        sell: 87.85 + (Math.random() * 0.5 - 0.25),
                        last: 87.88,
                        change: (Math.random() * 2 - 1).toFixed(2)
                    };
                }

                // Store data
                exchangeData[exchange.id] = {
                    ...data,
                    fees: exchange.fees,
                    timestamp: new Date()
                };

                // Update price history
                priceHistory[exchange.id].push({
                    time: Date.now(),
                    price: data.last
                });

                // Keep only last 30 minutes of history
                const thirtyMinutesAgo = Date.now() - (30 * 60 * 1000);
                priceHistory[exchange.id] = priceHistory[exchange.id].filter(
                    p => p.time > thirtyMinutesAgo
                );

                // Update UI
                updateExchangeCard(exchange.id, data);
                statusEl.className = 'exchange-status connected';

            } catch (error) {
                console.error(`Error fetching ${exchange.name}:`, error);
                statusEl.className = 'exchange-status error';
                errorEl.textContent = 'Failed to fetch prices';
                errorEl.style.display = 'block';
            }
        }

        // Update exchange card UI
        function updateExchangeCard(exchangeId, data) {
            document.getElementById(`buy-${exchangeId}`).textContent = `₹${data.buy.toFixed(2)}`;
            document.getElementById(`sell-${exchangeId}`).textContent = `₹${data.sell.toFixed(2)}`;
            
            const spread = ((data.buy - data.sell) / data.sell * 100).toFixed(3);
            document.getElementById(`spread-${exchangeId}`).textContent = `${spread}%`;
            
            const changeEl = document.getElementById(`change-${exchangeId}`);
            changeEl.textContent = `${data.change}%`;
            changeEl.className = `price-value ${parseFloat(data.change) >= 0 ? 'up' : 'down'}`;
        }

        // Update overall UI stats
        function updateUI() {
            const activeExchanges = Object.keys(exchangeData).length;
            document.getElementById('activeExchanges').textContent = `${activeExchanges}/4`;

            if (activeExchanges > 0) {
                const prices = Object.entries(exchangeData);
                
                // Find best buy (lowest)
                const bestBuy = prices.reduce((min, [id, data]) => 
                    data.buy < min.price ? { id, price: data.buy } : min,
                    { id: null, price: Infinity }
                );
                
                // Find best sell (highest)
                const bestSell = prices.reduce((max, [id, data]) => 
                    data.sell > max.price ? { id, price: data.sell } : max,
                    { id: null, price: -Infinity }
                );

                if (bestBuy.id) {
                    const exchange = EXCHANGES.find(e => e.id === bestBuy.id);
                    document.getElementById('bestBuy').textContent = 
                        `${exchange.name} @ ₹${bestBuy.price.toFixed(2)}`;
                }

                if (bestSell.id) {
                    const exchange = EXCHANGES.find(e => e.id === bestSell.id);
                    document.getElementById('bestSell').textContent = 
                        `${exchange.name} @ ₹${bestSell.price.toFixed(2)}`;
                }
            }
        }

        // Find arbitrage opportunities
        function findArbitrageOpportunities() {
            const opportunities = [];
            const volume = parseFloat(document.getElementById('volumeInput').value);
            const minProfit = parseFloat(document.getElementById('minProfitInput').value);

            const exchanges = Object.entries(exchangeData);

            for (let i = 0; i < exchanges.length; i++) {
                for (let j = 0; j < exchanges.length; j++) {
                    if (i === j) continue;

                    const [buyId, buyData] = exchanges[i];
                    const [sellId, sellData] = exchanges[j];

                    const buyPrice = buyData.buy;
                    const sellPrice = sellData.sell;

                    // Calculate profit considering fees
                    const buyFee = volume * buyData.fees;
                    const sellFee = volume * sellData.fees;
                    const totalFees = buyFee + sellFee;

                    const quantity = volume / buyPrice;
                    const grossProfit = (sellPrice - buyPrice) * quantity;
                    const netProfit = grossProfit - totalFees;
                    const profitPercentage = (netProfit / volume) * 100;

                    if (profitPercentage >= minProfit) {
                        opportunities.push({
                            buyExchange: EXCHANGES.find(e => e.id === buyId),
                            sellExchange: EXCHANGES.find(e => e.id === sellId),
                            buyPrice,
                            sellPrice,
                            grossProfit,
                            netProfit,
                            profitPercentage,
                            volume
                        });
                    }
                }
            }

            // Sort by profit percentage
            opportunities.sort((a, b) => b.profitPercentage - a.profitPercentage);

            // Update max profit display
            const maxProfit = opportunities.length > 0 ? opportunities[0].profitPercentage : 0;
            document.getElementById('maxProfit').textContent = `${maxProfit.toFixed(2)}%`;

            // Display opportunities
            displayOpportunities(opportunities);
        }

        // Display arbitrage opportunities
        function displayOpportunities(opportunities) {
            const list = document.getElementById('opportunityList');

            if (opportunities.length === 0) {
                list.innerHTML = '<div class="loading">No profitable opportunities found</div>';
                return;
            }

            list.innerHTML = opportunities.slice(0, 5).map(opp => `
                <div class="opportunity-card">
                    <div class="opportunity-details">
                        <div class="opportunity-route">
                            ${opp.buyExchange.name} → ${opp.sellExchange.name}
                        </div>
                        <div class="opportunity-prices">
                            Buy: ₹${opp.buyPrice.toFixed(2)} | Sell: ₹${opp.sellPrice.toFixed(2)}
                        </div>
                        <div class="opportunity-prices">
                            Volume: ₹${opp.volume.toLocaleString()} | Profit: ₹${opp.netProfit.toFixed(2)}
                        </div>
                    </div>
                    <div class="opportunity-profit">
                        <div class="profit-percentage">${opp.profitPercentage.toFixed(2)}%</div>
                        <div class="profit-amount">₹${opp.netProfit.toFixed(2)}</div>
                    </div>
                </div>
            `).join('');
        }

        // Auto refresh functionality
        function startAutoRefresh() {
            if (!autoRefresh) return;

            refreshInterval = parseInt(document.getElementById('refreshInterval').value);
            let countdown = refreshInterval / 1000;

            // Update countdown
            countdownTimer = setInterval(() => {
                countdown--;
                if (countdown >= 0) {
                    document.getElementById('refreshTimer').textContent = `${countdown}s`;
                }
            }, 1000);

            // Refresh prices
            refreshTimer = setTimeout(() => {
                refreshPrices();
                clearInterval(countdownTimer);
                startAutoRefresh();
            }, refreshInterval);
        }

        // Toggle auto refresh
        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const btn = document.getElementById('autoRefreshBtn');
            const status = document.getElementById('refreshStatus');

            if (autoRefresh) {
                btn.textContent = 'Auto Refresh: ON';
                btn.className = 'btn success';
                status.textContent = 'ON';
                startAutoRefresh();
            } else {
                btn.textContent = 'Auto Refresh: OFF';
                btn.className = 'btn danger';
                status.textContent = 'OFF';
                clearTimeout(refreshTimer);
                clearInterval(countdownTimer);
            }
        }

        // Handle refresh interval change
        document.getElementById('refreshInterval').addEventListener('change', (e) => {
            clearTimeout(refreshTimer);
            clearInterval(countdownTimer);
            if (autoRefresh) {
                startAutoRefresh();
            }
        });

        // Handle volume/profit threshold changes
        document.getElementById('volumeInput').addEventListener('change', findArbitrageOpportunities);
        document.getElementById('minProfitInput').addEventListener('change', findArbitrageOpportunities);

        // Initialize on load
        init();
    </script>
</body>
</html>